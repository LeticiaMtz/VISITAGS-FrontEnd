<form (ngSubmit)="comentarAlerta(forma)" class="form" #forma>
    <div class="row">
        <div class="col-md-12">
            <div class="card px-2 pb-2">
                <div class="row container card-body mb-3">
                    <div class="col-md-6 align-self-start">
                        <div class="row">
                            <i class="fa fa-user-circle mr-2"></i>
                            <small style="font-size: 4;">{{ userName }} </small>
                        </div>
                        <div class="row">
                            <small class="text-primary ml-4" style="font-size: 2;"> {{objSubject.strAsignatura}} </small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row justify-content-end">
                            <span class="badge badge-info" *ngIf="nuevo !== principalStatus && enProgreso !== principalStatus && cerrado !== principalStatus && finalizado !== principalStatus">Nuevo</span>
                            <span class="badge badge-info" *ngIf="nuevo == principalStatus">Nuevo</span>
                            <span class="badge badge-danger" *ngIf="cerrado == principalStatus">Cerrado</span>
                            <span class="badge badge-warning" *ngIf="enProgreso == principalStatus">Proceso</span>
                            <span class="badge badge-success" *ngIf="finalizado == principalStatus">Finalizado</span>
                        </div>
                        <div class="row justify-content-end mt-1">
                            <i class="fa fa-calendar mr-2"></i>
                            <small style="font-size: 2;"> {{objAlert.createdAt | date}} </small>
                        </div>
                    </div>
                </div>
        
                <div class="container">
                    <div class="row">
                        <div class="col-md-5">
                            <div class="container">
                                <table class="table table-bordered table-sm table-hover align-items-center" style="font-size: small;">
                                    <thead>
                                        <tr>
                                            <th>Datos del alumno</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Matricula</td>
                                            <td>{{objAlert.strMatricula}}</td>
                                        </tr>
                                        <tr>
                                            <td>Nombre</td>
                                            <td>{{objAlert.strNombreAlumno}}</td>
                                        </tr>
                                        <tr>
                                            <td>Grado y Grupo</td>
                                            <td>{{objAlert.strGrupo}}</td>
                                        </tr>
                                        <tr>
                                            <td>Turno</td>
                                            <td>{{objAlert.chrTurno}}</td>
                                        </tr>
                                        <tr>
                                            <td>Modalidad</td>
                                            <td>{{objModality.strModalidad}}</td>
                                        </tr>
                                    </tbody>
                                </table>    
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="container">
                                <table class="table table-bordered table-sm table-hover align-items-center"  style="font-size: small;">
                                    <thead>
                                        <tr>
                                            <th class="text-center">Observaciones</th>
                                        </tr>
                                    </thead>
            
                                    <!-- SE MUESTRA CUANDO HAY REGISTROS -->
                                    <tbody>
                                        <tr>
                                            <td> {{objAlert.strDescripcion}}</td>
                                        </tr>
                                    </tbody>
                                </table>   
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="container">
                                <table class="table table-bordered table-sm table-hover align-items-center" style="font-size: small;">
                                    <thead>
                                        <tr>
                                            <th class="text-center">Evidencias</th>
                                        </tr>
                                    </thead>
            
                                    <!-- SE MUESTRA CUANDO HAY REGISTROS--> 
                                    <tbody class="text-center">
                                        <tr>
                                            <td *ngFor="let doc of arrFiles">
                                                <a (click)="descargarArchivo(doc.strNombre)" class="stretched-link mr-3"> {{doc.strNombre}} </a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
        
                    
                    <div class="row container">
                        <div class="col-md-12">
                            <span class="badge badge-danger mr-2" *ngFor="let reason of arrReasons"> {{reason.strCategoria}} </span>
                        </div>
                    </div>
        
                </div>

            </div>
        </div>
    </div>

<!-- COMENTARIOS divScroll mb-4-->
    <div class="">
        <div class="row">
            <div class="col-md-12">
                <div class="row justify-content-end">
                    <div class="col-11">
                        <div class="card px-2" *ngFor="let data of arrTracking">
                            <div class="container card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <i class="fa fa-user-circle mr-2 text-info"></i>
                                                <small style="font-size: 4;">{{data.idUser.strName}}</small>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <small class="text-primary ml-4" style="font-size: 2;">{{data.idUser.idRole.strRole}}</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row justify-content-end">
                                            <span class="badge badge-info" *ngIf="nuevo == data.idEstatus">Nuevo</span>
                                            <span class="badge badge-danger" *ngIf="cerrado == data.idEstatus">Cerrado</span>
                                            <span class="badge badge-warning" *ngIf="enProgreso == data.idEstatus">Proceso</span>
                                            <span class="badge badge-success" *ngIf="finalizado == data.idEstatus">Finalizado</span>
                                        </div>
                                        <div class="row justify-content-end mt-1">
                                            <i class="fa fa-calendar mr-2"></i>
                                            <small style="font-size: 2;">{{data.createdAt | date}}</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="row container mt-2">
                                    <div class="col-md-12">
                                        <p> {{data.strComentario}} </p>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-12" >
                                        <div *ngFor="let archivos of data.aJsnEvidencias">
                                            <a (click)="descargarArchivo(archivos.strFileEvidencia)"  style="font-size: x-small;cursor: pointer;">{{archivos.strFileEvidencia}}</a>
                    
                                        </div>   
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
<!-- AGREGAR COMENTARIOS -->
    <div class="">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <i class="fa fa-comments " style="font-size:24px; "></i> 
                                    <small style="font-size: 4; "> Comentar</small> 
        
                                <hr>
        
                                <div class="row justify-content-between">
                                    <div class="col-md-12 mt-1 ">
                                        <textarea class="form-control form-control-sm " rows="3 " maxlength="300 " placeholder="Observaciones" name="strComentario" [(ngModel)]="objTracking.strComentario" required #strComentario="ngModel"></textarea>
                                    </div>
                                    <div class="col-6 mt-2">
                                        <select [class.is-invalid]="idEstatus.invalid && idEstatus.touched" class="custom-select selectpicker form-control form-control-sm" type="text" title="Seleccione Estatus" name="idEstatus" [(ngModel)]="objTracking.idEstatus" required #idEstatus="ngModel">
                                            <option *ngFor="let estatus of arrEstatus"  [ngValue]="estatus._id" > {{estatus.strNombre}} </option>
                                        </select>
                                    </div>
                                    <div class="invalid-feedback" *ngIf="idEstatus.errors?.required">
                                        <small>
                                            Por favor, seleccione una opción.
                                        </small>
                                    </div>
        
                                    <div class="col-5 mt-2">
                                        <button [disabled]="forma.invalid" type="submit" class="btn btn-sm btn-outline-success btn-block float-right">Enviar</button>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <i class="fa fa-file " style="font-size:24px; "></i>
                                <small style="font-size: 4; "> Adjuntar Archivos</small> 
        
                                <hr>

                                <app-file-uploader *ngIf="!resetImage" (archivosObtenidos)="obtenerArchivos($event)"></app-file-uploader>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

