<form (ngSubmit)="comentarAlerta(forma)" class="form" novalidate="" enctype="multipart/form-data" #forma="ngForm">

    <div class="row">
        <div class="col-md-12">
            <div class="card px-2 pb-2">
                <div class="card-body">
                    <div class="row">
                        <div class="col-6 d-none d-md-block">
                            <i class="fa fa-user-circle"></i>&nbsp;&nbsp;<small style="font-size: 4;">{{ userName }}</small><br>
                            <small class="text-primary ml-4" style="font-size: 2;"> {{objSubject.strAsignatura}} </small>
                        </div>
                        <div class="col-6 d-sm-none">
                            <small style="font-size: 4;">{{ userName }}</small><br>
                            <small class="text-primary" style="font-size: 2;"> {{objSubject.strAsignatura}} </small>
                        </div>

                        <div class="col-6 text-right">
                            <div class="row justify-content-end">
                                <span class="badge badge-info" *ngIf="nuevo !== principalStatus && enProgreso !== principalStatus && cerrado !== principalStatus && finalizado !== principalStatus">OTRO</span>
                                <span class="badge badge-info" *ngIf="nuevo == principalStatus"><i class="fa fa-star"></i> Nueva</span>
                                <span class="badge badge-danger" *ngIf="cerrado == principalStatus"><i class="fa fa-times"></i> Cancelada</span>
                                <span class="badge badge-warning" *ngIf="enProgreso == principalStatus"><i class="fa fa-cog fa-spin fa fa-fw"></i> En Proceso</span>
                                <span class="badge badge-success" *ngIf="finalizado == principalStatus"><i class="fa fa-check"></i> Finalizado</span>
                            </div>
                            <div class="row justify-content-end mt-1">
                                <i class="fa fa-calendar mr-2"></i>
                                <small style="font-size: 2;"> {{objAlert.createdAt | date}} </small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mx-3">
                    <div class="col-md-12">
                        <div id="accordion" class="accordion border">
                            <div class="card-header" id="headingOne">
                                <h5 class="mb-0">
                                    <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                        <i class="fa fa-graduation-cap" aria-hidden="true"></i> Datos del alumno
                                    </button>
                                </h5>
                            </div>

                            <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                                <div class="card-body table-responsive">
                                    <table class="table table-bordered table-sm table-hover align-items-center" style="font-size: small;">
                                        <thead>
                                            <tr>
                                                <th>Matricula</th>
                                                <th>Nombre</th>
                                                <th>Grado y Grupo</th>
                                                <th>Carerra</th>
                                                <th>Turno</th>
                                                <th>Modalidad</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let matricula of arrMatriculas; let i = index;">
                                                <td>{{arrMatriculas[i]}}</td>
                                                <td>{{arrAlumnos[i]}}</td>
                                                <td>{{objAlert.strGrupo}}</td>
                                                <td>{{ strCarrera }}</td>
                                                <td>{{objAlert.chrTurno}}</td>
                                                <td>{{objModality.strModalidad}}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="card-header" id="headingTwo">
                                <h5 class="mb-0">
                                    <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Observaciones
                                    </button>
                                </h5>
                            </div>
                            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                                <div class="card-body">
                                    <div>
                                        <p>{{objAlert.strDescripcion}}</p>
                                    </div>
                                </div>
                            </div>

                            <div class="card-header" id="headingThree">
                                <h5 class="mb-0">
                                    <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                        <i class="fa fa-files-o" aria-hidden="true"></i> Evidencias
                                    </button>
                                </h5>
                            </div>
                            <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                                <div class="card-body">
                                    <button *ngFor="let doc of arrFiles" type="button" (click)="descargarArchivoE(doc.strNombre)" class="btn btn-link" style="cursor: pointer;"><i class="fa fa-download mr-1"></i> {{doc.strNombre}} </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- cambiar la clave por el nombre de la razon de riesgo -->
                <div class="row mx-3 my-3">
                    <div class="col-md-12">
                        <span class="badge badge-danger" data-toggle="tooltip" data-placement="right" title="{{reason.strNombre}}" style="margin-right: 5px;" *ngFor="let reason of arrReasons">{{reason.strNombre}}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- COMENTARIOS divScroll mb-4-->

    <div #comentarios class="row mb-4 justify-content-end divScroll">
        <div class="col-sm-10 col-11">
            <div class="card px-2 animated fadeInUp fast" *ngFor="let data of arrTracking">
                <div class="card-body">
                    <div class="row">
                        <div class="col-6 d-none d-md-block">
                            <i class="fa fa-user-circle"></i>&nbsp;&nbsp;<small style="font-size: 4;">{{ data.idUser.strName }}</small><br>
                            <small class="text-primary ml-4" style="font-size: 2;"> {{ data.idUser.idRole.strRole }} </small>
                        </div>
                        <div class="col-6 d-sm-none">
                            <small style="font-size: 4;">{{ data.idUser.strName }}</small><br>
                            <small class="text-primary" style="font-size: 2;"> {{ data.idUser.idRole.strRole }} </small>
                        </div>

                        <div class="col-6 text-right">
                            <div class="row justify-content-end">
                                <span class="badge badge-info" *ngIf="nuevo == data.idEstatus"><i class="fa fa-star"></i> Nueva</span>
                                <span class="badge badge-danger" *ngIf="cerrado == data.idEstatus"><i class="fa fa-times"></i> Cancelada</span>
                                <span class="badge badge-warning" *ngIf="enProgreso == data.idEstatus"><i class="fa fa-cog fa-spin fa fa-fw"></i> En Proceso</span>
                                <span class="badge badge-success" *ngIf="finalizado == data.idEstatus"><i class="fa fa-check"></i> Finalizado</span>
                                <span class="badge badge-info" *ngIf="nuevo !== data.idEstatus && enProgreso !== data.idEstatus && cerrado !== data.idEstatus && finalizado !== data.idEstatus">OTRO</span>
                            </div>
                            <div class="row justify-content-end mt-1">
                                <i class="fa fa-calendar "></i>&nbsp;
                                <small style="font-size: 2;"> {{data.createdAt | date}} </small>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2 ml-2">
                        <div class="col-12">
                            <p [innerHTML]="data.strComentario"></p>
                        </div>
                    </div>
                    <div class="row mt-1">
                        <div class="col-12">
                            <button type="button" *ngFor="let archivos of data.aJsnEvidencias" (click)="descargarArchivoE(archivos.strNombre)" class="btn btn-link" style="font-size: x-small; cursor: pointer;">
                                &nbsp;&nbsp;&nbsp;<i class="fa fa-download"></i> {{archivos.strNombre}}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AGREGAR COMENTARIOS -->
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8 col-sm-10 col-xs-11">
                            <i class="fa fa-comments" style="font-size:24px; "></i>
                            <small style="font-size: 4;">&nbsp;&nbsp;Comentar</small>

                            <hr>

                            <div class="row justify-content-between">
                                <div class="col-md-12 mt-1 ">
                                    <textarea [class.is-invalid]="strComentario.invalid && strComentario.touched" class="form-control form-control-sm " rows="3 " maxlength="300 " placeholder="Observaciones" name="strComentario" [(ngModel)]="objTracking.strComentario" required #strComentario="ngModel"></textarea>
                                    <div class="invalid-feedback" *ngIf="strComentario.errors?.required">
                                        <small>
                                                Por favor, ingrese un comentario.
                                            </small>
                                    </div>
                                </div>

                                <div class="col-4 mt-2">
                                    <select [class.is-invalid]="idEstatus.invalid && idEstatus.touched" class="custom-select form-control form-control-sm" type="text" name="idEstatus" [(ngModel)]="objTracking.idEstatus" required #idEstatus="ngModel">
                                            <option [ngValue]="undefined" disabled selected hidden>Seleccione Estatus</option>
                                            <option *ngFor="let estatus of arrEstatus" [ngValue]="estatus._id"> {{estatus.strNombre}} </option>
                                        </select>
                                    <div class="invalid-feedback" *ngIf="idEstatus.errors?.required">
                                        <small>
                                                Por favor, seleccione una opción.
                                            </small>
                                    </div>
                                </div>

                                <!-- Button trigger modal -->
                                <div class="col-4 mt-2">
                                    <button type="button" class="btn btn-outline-info btn-sm btn-block float-right" data-toggle="modal" data-target="#colaborador-modal">
                                        <!-- <i class="fa fa-user-plus mr-2"></i> -->
                                        Invitar Colaborador
                                    </button>
                                </div>


                                <div class="col-4 mt-2">
                                    <button type="submit" class="btn btn-outline-success btn-sm btn-block float-right">Comentar</button>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <i class="fa fa-upload" style="font-size:24px; "></i>
                            <small style="font-size: 4; ">&nbsp;&nbsp;Adjuntar Archivos</small>

                            <hr>

                            <app-file-uploader *ngIf="!resetImage" (archivosObtenidos)="obtenerArchivos($event)" (archivoEliminado)="eliminarArchivo($event)"></app-file-uploader>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>


<!-- Modal Colaboradores-->
<div class="modal fade" id="colaborador-modal" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-info" id="staticBackdropLabel"><i class="fa fa-user-plus"></i> Invitar Colaboradores</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <div class="container">
                        <span aria-hidden="true">&times;</span>
                    </div>
                </button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <form #formaColaboradores="ngForm">
                        <div class="container p-20">

                            <div class="row" *ngIf="arrColaboradores.length == 0">
                                <div class="col-md-12">
                                    <div class="container text-center">
                                        <h4 style="text-align:left;">No Hay Colaboradores Agregados. <strong class="text-info" style="cursor: pointer;" (click)="addColaborador(formaColaboradores)">Agregar Uno <i class="fa fa-plus-circle"></i></strong></h4>
                                    </div>
                                </div>
                            </div>

                            <div class="row mt-2" *ngFor="let colaborador of arrColaboradores; let ind = index;">
                                <div class="col-md-11">
                                    <app-bootstrap-select [ngForm]="formaColaboradores" [name]="'_id'+ind" [datos]="personas" (model)="colaborador._id = $event" [titulo]="'Seleccione un Colaborador'" [multiple]="false" [dataLiveSearch]="true" mensajeValidacion="Es necesario seleccinar un colaborador"
                                        [required]="true"></app-bootstrap-select>
                                </div>
                                <div class="col-md-1">
                                    <button type="button" class="btn btn-sm btn-block btn-outline-danger" (click)="eliminarColaborador(formaColaboradores, ind)"><i class="fa fa-minus"></i></button>
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col-md-12">
                                    <button type="button" class="btn btn-outline-success btn-sm btn-block" (click)="addColaborador(formaColaboradores)"><i class="fa fa-plus"></i> Nuevo Colaborador</button>
                                </div>
                            </div>

                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <!-- <i class="fa fa-send mr-2"></i> -->
                <button type="button" class="btn btn-info btn-block" data-dismiss="modal">¡Listo!</button>
            </div>
        </div>
    </div>
</div>